<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/manage.css">
    <link rel="stylesheet" type="text/css" href="./css/myNavbar.css">
    <title>成员管理</title>

</head>
<body>
    <div class="navbar">
    
        <a href="#" class="logo">每日英语</a>
        <a href="index.html">首页</a>
        <a href="#">关于</a>
        <a href="#">联系我们</a>
    
    <div class="dropdown">
        <button class="dropbtn">发布任务</button>
        <div class="dropdown-content">
            <a href="#">考试</a>
            <a href="#">作业</a>
            <a href="#">每日单词</a>
        </div>
    </div>
    <div class="search-container">
        <form action="#">
            <input type="text" placeholder="Search.." name="search">
            <button type="submit">搜索</button>
        </form>
    </div>
</div>
    <div class="background">
    <h1>成员管理</h1> 
    <div class="search-container2">  
        <input type="text" class="search-input" placeholder="成员查询">  
        <button class="search-button" onclick="searchFunction()">搜索</button>  
    </div> 

    <div class="box">
        <button class="button" id="button1">成员审核</button>
        <button class="button" id="button2">团队扩容申请</button>
        <table>
            <thead>
            <tr>
                <th class="list1">成员名称</th>
                <th class="list2">加入时间</th>
                <th class="list3">累计打卡</th>
                <th class="list4">操作</th>
            </tr>
            </thead>
            <tbody id="userList">
            
            </tbody>
        </table>
    </div>

    <script>  
      // 获取按钮元素
    var button = document.getElementById("button1");

    // 添加点击事件侦听器
    button.addEventListener("click", function() {
    // 在此处执行页面跳转操作
    window.location.href = "examine.html";
    });
   // 假设这是从后台获取的数据，初始为空数组  
        var data = [];  
        var token='sdadasdsa';
        // 这是自己填的数据，不知道实际能不能用  
        var defaultData = [  
            { "username": "abc", "RegisterDate": "2024.1.2", "sign_in": "121", "operation": "详情" },  
            { "username": "123", "RegisterDate": "2024.1.2", "sign_in": "101", "operation": "详情" },  
            { "username": "556", "RegisterDate": "2024.1.2", "sign_in": "212", "operation": "详情" },  
            { "username": "bce", "RegisterDate": "2024.1.2", "sign_in": "111", "operation": "详情" },  
            { "username": "jds", "RegisterDate": "2024.1.2", "sign_in": "123", "operation": "详情" }
        ];  
        
        fetch('http://localhost:8080/api/team_manage/all_managements', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'token':token
        },
    }).then(response => {
        return response.json();
    }).then(responsedata => {
        if (responsedata.code === 200) {
            console.log(responsedata);
            var members=responsedata.members;
            members.forEach(member =>{
                let username=member.username;
                let join_time=member.join_time;
                let sign_in=member.sign_in;
                let email=member.email;
                let phone_number=member.phone_number;
            }
            )
            sessionStorage.setItem("token", responsedata.token);
            fillTable(members, tbody);
        } else {
            var message = document.getElementById("verification-message");
            message.textContent = responsedata.message;
            message.style.color = "red";
            fillTable(defaultData, tbody);
        }
    }).catch(error => {  
        console.error('There has been a problem with your fetch operation:', error);   
        fillTable(defaultData, tbody);
    });  
  
        // 获取tbody元素  
        var tbody = document.getElementById('userList');  
          
        function fillTable(data, tbody) {
        tbody.innerHTML = "";

        // 遍历数据并创建表格行    
        data.forEach(member => {    
        var tr = document.createElement('tr');    
        var tdusername = document.createElement('td');    
        var tdRegisterDate = document.createElement('td');    
        var tdsign_in = document.createElement('td');    
        var tdOperation = document.createElement('td');    
        
        tdusername.className = 'list1';    
        tdRegisterDate.className = 'list1';    
        tdsign_in.className = 'list1';    
        tdOperation.className = 'list1';    
  
        tdusername.textContent = member.username;    
        tdRegisterDate.textContent = member.RegisterDate;    
        tdsign_in.textContent = member.sign_in;  // 确保数据项中有attendance属性  
        
        // 创建按钮元素并设置文本内容  
        var operationButton = document.createElement('button');  
        operationButton.textContent = member.operation; // 假设item.operation是按钮上应该显示的文本  
        operationButton.addEventListener('click', function() {  
            // 这里是按钮点击时应该执行的代码  
            // 例如，可以调用一个处理函数并传递当前行的数据或执行其他逻辑  
            handleButtonClick(member);  
        });  
        
        // 将按钮添加到操作单元格中  
        tdOperation.appendChild(operationButton);    
        
        tr.appendChild(tdusername);    
        tr.appendChild(tdRegisterDate);    
        tr.appendChild(tdsign_in);    
        tr.appendChild(tdOperation);    
        
        tbody.appendChild(tr);    
});    
}
// 按钮点击事件处理函数  
function handleButtonClick(member) {  
    // 在这里处理按钮点击事件，比如弹出一个对话框显示用户详情  
    alert('用户详情: ' + member.username);  
    // 还可以根据需要进行其他操作，比如发送请求到服务器获取更多信息
}

        </script>  
</body>
</html>