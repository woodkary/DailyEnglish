<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/examine.css">
    <link rel="stylesheet" type="text/css" href="./css/myNavbar.css">
    <title>成员审核</title>

</head>
<body>
    <div class="navbar">
    
        <a href="#" class="logo">每日英语</a>
        <a href="index.html">首页</a>
        <a href="#">关于</a>
        <a href="#">联系我们</a>
    
    <div class="dropdown">
        <button class="dropbtn">发布任务</button>
        <div class="dropdown-content">
            <a href="#">考试</a>
            <a href="#">作业</a>
            <a href="#">每日单词</a>
        </div>
    </div>
    <div class="search-container">
        <form action="#">
            <input type="text" placeholder="Search.." name="search">
            <button type="submit">搜索</button>
        </form>
    </div>
</div>
    <div class="background">
    <h1>成员审核</h1> 
    <div class="search-container2">  
        <input type="text" class="search-input" placeholder="申请用户查询">  
        <button class="search-button" onclick="searchFunction()">搜索</button>  
    </div> 

    <div class="box">
        <button class="button" id="button2">团队扩容申请</button>
        <table>
            <thead>
            <tr>
                <th class="list1">成员名称</th>
                <th class="list2">加入时间</th>
                <th class="list3">邮箱</th>
                <th class="list4">操作</th>
            </tr>
            </thead>
            <tbody id="userList">
            
            </tbody>
        </table>
    </div>

    <script>  
        // 假设这是从后台获取的数据，初始为空数组  
        var data = [];  
        var token='sdadasdsa';
        // 这是自己填的数据，不知道实际能不能用  
        var defaultData = [  
            { "username": "abc", "RegisterDate": "2024.1.2", "email": "12345678@qq.com", "operation": "通过" },  
            { "username": "123", "RegisterDate": "2024.1.2", "email": "12345678@qq.com", "operation": "通过" },  
            { "username": "556", "RegisterDate": "2024.1.2", "email": "12345678@qq.com", "operation": "通过" },  
            { "username": "bce", "RegisterDate": "2024.1.2", "email": "12345678@qq.com", "operation": "通过" },  
            { "username": "jds", "RegisterDate": "2024.1.2", "email": "12345678@qq.com", "operation": "通过" }
        ];  
        
        fetch('http://localhost:8080/api/team_manage/all_managements', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'token':token
        },
    }).then(response => {
        return response.json();
    }).then(responsedata => {
        if (responsedata.code === 200) {
            console.log(responsedata);
            var members=responsedata.members;
            members.forEach(member =>{
                let username=member.username;
                let join_time=member.join_time;
                let sign_in=member.sign_in;
                let email=member.email;
                let phone_number=member.phone_number;
            }
            )
            sessionStorage.setItem("token", responsedata.token);
            fillTable(members, tbody);
        } else {
            var message = document.getElementById("verification-message");
            message.textContent = responsedata.message;
            message.style.color = "red";
            fillTable(defaultData, tbody);
        }
    }).catch(error => {  
        console.error('There has been a problem with your fetch operation:', error);   
        fillTable(defaultData, tbody);
    });  
  
        // 获取tbody元素  
        var tbody = document.getElementById('userList');  
          
        function fillTable(data, tbody) {
        tbody.innerHTML = "";

        // 遍历数据并创建表格行    
        data.forEach(member => {    
        var tr = document.createElement('tr');    
        var tdusername = document.createElement('td');    
        var tdRegisterDate = document.createElement('td');    
        var tdemail = document.createElement('td');    
        var tdOperation = document.createElement('td');    
        
        tdusername.className = 'list1';    
        tdRegisterDate.className = 'list1';    
        tdemail.className = 'list1';    
        tdOperation.className = 'list1';    
  
        tdusername.textContent = member.username;    
        tdRegisterDate.textContent = member.RegisterDate;    
        tdemail.textContent = member.email;  // 确保数据项中有attendance属性  
        
        // 创建通过按钮
        var approveButton = document.createElement('button');  
        approveButton.textContent = '同意';
        approveButton.className = 'button-spacing'; 
        approveButton.addEventListener('click', function() {  
           // 处理通过按钮点击事件
            handleApproveClick(member);
        });

        // 创建拒绝按钮
        var rejectButton = document.createElement('button');  
        rejectButton.textContent = '拒绝';
        rejectButton.className = 'button-spacing'; 
        rejectButton.addEventListener('click', function() {  
           // 处理拒绝按钮点击事件
           handleRejectClick(member);
        });

        // 创建操作单元格并将按钮添加到其中
        var tdOperation = document.createElement('td');
        tdOperation.className = 'list1';
        tdOperation.appendChild(approveButton);
        tdOperation.appendChild(rejectButton);
    
        
        tr.appendChild(tdusername);    
        tr.appendChild(tdRegisterDate);    
        tr.appendChild(tdemail);    
        tr.appendChild(tdOperation);    
        
        tbody.appendChild(tr);    
});    
}
// 按钮点击事件处理函数  
function handleApproveClick(member) {  
    // 在这里处理按钮点击事件，比如弹出一个对话框显示用户详情  
    alert(member.username+'审核通过');  
    // 还可以根据需要进行其他操作，比如发送请求到服务器获取更多信息
}
function handleRejectClick(member) {  
    // 在这里处理按钮点击事件，比如弹出一个对话框显示用户详情  
    alert('拒绝'+member.username+'通过审核');  
    // 还可以根据需要进行其他操作，比如发送请求到服务器获取更多信息
}

        </script>  
</body>
</html>